{% extends 'base.html' %}
{% block title %}Foreign Exchange Rates{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h2 class="text-3xl font-bold flex items-center gap-2">
                <i class="bi bi-currency-exchange"></i>
                Foreign Exchange Rates
            </h2>
            <p class="text-base-content/70">Real-time currency exchange rates and converter</p>
        </div>
        <div class="text-right">
            <small class="text-base-content/60" id="rateUpdateTime">Last updated: Loading...</small>
        </div>
    </div>

    <!-- Main FX Rate Display -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-header bg-base-200 p-3 rounded-t-xl">
            <h5 class="text-lg font-semibold flex items-center gap-2">
                <i class="bi bi-graph-up"></i>
                Live Exchange Rate
            </h5>
        </div>
        <div class="card-body p-4">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-3 items-center mb-4">
                <div class="md:col-span-2">
                    <label class="form-control">
                        <div class="label py-1">
                            <span class="label-text text-sm">From</span>
                        </div>
                        <select class="select select-bordered select-sm" id="sourceCurrency">
                            <option value="">Select Currency</option>
                            <option value="JOD" selected>JOD</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="JPY">JPY</option>
                            <option value="SAR">SAR</option>
                            <option value="AED">AED</option>
                            <option value="KWD">KWD</option>
                            <option value="QAR">QAR</option>
                            <option value="BHD">BHD</option>
                        </select>
                    </label>
                </div>
                <div class="flex justify-center">
                    <button class="btn btn-outline btn-sm btn-circle" id="swapCurrencies" title="Swap currencies">
                        <i class="bi bi-arrow-left-right text-xs"></i>
                    </button>
                </div>
                <div class="md:col-span-2">
                    <label class="form-control">
                        <div class="label py-1">
                            <span class="label-text text-sm">To</span>
                        </div>
                        <select class="select select-bordered select-sm" id="targetCurrency">
                            <option value="">Select Currency</option>
                            <option value="JOD">JOD</option>
                            <option value="USD" selected>USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="JPY">JPY</option>
                            <option value="SAR">SAR</option>
                            <option value="AED">AED</option>
                            <option value="KWD">KWD</option>
                            <option value="QAR">QAR</option>
                            <option value="BHD">BHD</option>
                        </select>
                    </label>
                </div>
            </div>

            <div class="py-4 hidden" id="rateDisplay">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 items-center">
                    <!-- Main Rate Display -->
                    <div class="text-center lg:text-left">
                        <h2 class="text-2xl font-bold">
                            1 <span id="sourceCurrencyCode">JOD</span> =
                            <span id="currentRate" class="text-primary">1.41</span>
                            <span id="targetCurrencyCode">USD</span>
                        </h2>
                        <p class="text-base-content/60 mt-1 text-sm">
                            Inverse: 1 <span id="targetCurrencyCode2">USD</span> =
                            <span id="inverseRate">0.71</span>
                            <span id="sourceCurrencyCode2">JOD</span>
                        </p>
                    </div>

                    <!-- Stats Badges -->
                    <div class="flex flex-wrap justify-center lg:justify-start gap-2">
                        <div class="badge badge-info badge-sm">Min: <span id="minRate">1.40</span></div>
                        <div class="badge badge-info badge-sm">Max: <span id="maxRate">1.42</span></div>
                        <div class="badge badge-success badge-sm">Avg: <span id="avgRate">1.41</span></div>
                    </div>

                    <!-- Source Info -->
                    <div class="text-center lg:text-right">
                        <small class="text-base-content/60 text-xs">Source: <span id="institutionName">Arab
                                Bank</span></small>
                    </div>
                </div>
            </div>

            <div class="text-center py-4" id="noRateDisplay">
                <p class="text-base-content/60 text-sm">Select currencies to view exchange rates</p>
            </div>
        </div>
    </div>

    <!-- Converter and Popular Rates -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Currency Converter -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-header bg-base-200 p-4 rounded-t-2xl">
                <h5 class="text-xl font-semibold flex items-center gap-2">
                    <i class="bi bi-calculator"></i>
                    Currency Converter
                </h5>
            </div>
            <div class="card-body">
                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text font-medium">Amount to Convert</span>
                    </label>
                    <div class="join w-full">
                        <select
                            class="select select-bordered join-item w-32 bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20"
                            id="convertSource">
                            <option value="">Select</option>
                            <option value="JOD">JOD</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="JPY">JPY</option>
                            <option value="SAR">SAR</option>
                            <option value="AED">AED</option>
                            <option value="KWD">KWD</option>
                            <option value="QAR">QAR</option>
                            <option value="BHD">BHD</option>
                        </select>
                        <input type="number"
                            class="input input-bordered join-item flex-1 bg-gradient-to-r from-base-200 to-base-100 focus:from-primary/10 focus:to-primary/5"
                            id="amountToConvert" value="1" min="0" step="0.01" placeholder="Enter amount">
                    </div>
                </div>

                <div class="flex justify-center mb-6">
                    <div class="w-8 h-8 rounded-full bg-blue-300 flex items-center justify-center">
                        <i class="bi bi-arrow-down text-base-100 text-sm"></i>
                    </div>
                </div>

                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text font-medium">Convert to</span>
                    </label>
                    <select
                        class="select select-bordered w-full bg-gradient-to-r from-secondary/10 to-secondary/5 border-secondary/20"
                        id="convertTarget">
                        <option value="">Select Currency</option>
                        <option value="JOD">JOD</option>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="SAR">SAR</option>
                        <option value="AED">AED</option>
                        <option value="KWD">KWD</option>
                        <option value="QAR">QAR</option>
                        <option value="BHD">BHD</option>
                    </select>
                </div>

                <button class="btn btn-primary w-full mb-6 border-0 shadow-lg" id="convertBtn">
                    <i class="bi bi-arrow-right mr-2"></i>
                    Convert Currency
                </button>

                <div class="card bg-gradient-to-r from-success/10 to-success/5 border-success/20 p-6 text-center hidden rounded-xl shadow-lg"
                    id="converterResult">
                    <div class="text-3xl font-bold mb-2 text-success" id="convertedAmount">1.41 USD</div>
                    <div class="divider my-2"></div>
                    <small class="text-base-content/70">Exchange rate: <span id="converterRate" class="font-medium">1
                            JOD = 1.41 USD</span></small>
                    <div class="mt-3">
                        <div class="badge badge-success badge-outline">
                            <i class="bi bi-check-circle mr-1"></i>
                            Conversion Complete
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Popular Rates -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-header bg-base-200 p-4 rounded-t-2xl flex justify-between items-center">
                <h5 class="text-xl font-semibold flex items-center gap-2">
                    <i class="bi bi-star-fill"></i>
                    Popular Currency Pairs
                </h5>
                <button class="btn btn-outline btn-sm" id="refreshPopularRates">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 gap-4" id="popularRates">
                    <div class="col-span-2 text-center">
                        <span class="loading loading-spinner loading-lg"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Institution Comparison -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-header bg-base-200 p-4 rounded-t-2xl">
            <h5 class="text-xl font-semibold flex items-center gap-2">
                <i class="bi bi-bank"></i>
                Institution Comparison
            </h5>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <select class="select select-bordered" id="compareSource">
                    <option value="">Source Currency</option>
                    <option value="JOD">JOD</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                    <option value="SAR">SAR</option>
                    <option value="AED">AED</option>
                    <option value="KWD">KWD</option>
                    <option value="QAR">QAR</option>
                    <option value="BHD">BHD</option>
                </select>
                <select class="select select-bordered" id="compareTarget">
                    <option value="">Target Currency</option>
                    <option value="JOD">JOD</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                    <option value="SAR">SAR</option>
                    <option value="AED">AED</option>
                    <option value="KWD">KWD</option>
                    <option value="QAR">QAR</option>
                    <option value="BHD">BHD</option>
                </select>
                <button class="btn btn-primary" id="compareBtn" disabled>
                    <i class="bi bi-search"></i>
                    Compare Rates
                </button>
            </div>
            <div id="institutionComparison" class="hidden">
                <div class="overflow-x-auto">
                    <table class="table table-zebra">
                        <thead>
                            <tr>
                                <th>Institution</th>
                                <th>Rate</th>
                                <th>Inverse Rate</th>
                                <th>Min Rate</th>
                                <th>Max Rate</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Rates -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-header bg-base-200 p-4 rounded-t-2xl">
            <h5 class="text-xl font-semibold flex items-center gap-2">
                <i class="bi bi-clock-history"></i>
                Recent Exchange Rates
            </h5>
        </div>
        <div class="card-body">
            <div class="overflow-x-auto">
                <table class="table table-zebra">
                    <thead>
                        <tr>
                            <th>Currency Pair</th>
                            <th>Rate</th>
                            <th>Institution</th>
                            <th>Effective Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>JOD/USD</td>
                            <td>1.4100</td>
                            <td>Arab Bank</td>
                            <td>Dec 15, 2024 14:30</td>
                        </tr>
                        <tr>
                            <td>USD/EUR</td>
                            <td>0.9200</td>
                            <td>Jordan Ahli Bank</td>
                            <td>Dec 15, 2024 14:25</td>
                        </tr>
                        <tr>
                            <td>EUR/GBP</td>
                            <td>0.8600</td>
                            <td>Bank of Jordan</td>
                            <td>Dec 15, 2024 14:20</td>
                        </tr>
                        <tr>
                            <td>USD/JPY</td>
                            <td>148.5000</td>
                            <td>Cairo Amman Bank</td>
                            <td>Dec 15, 2024 14:15</td>
                        </tr>
                        <tr>
                            <td>JOD/EUR</td>
                            <td>1.2972</td>
                            <td>Housing Bank</td>
                            <td>Dec 15, 2024 14:10</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // Static demo data
    const demoRates = {
        'JOD/USD': { rate: 1.41, inverse: 0.71, min: 1.40, max: 1.42, avg: 1.41, change: 0.0 },
        'USD/EUR': { rate: 0.92, inverse: 1.09, min: 0.90, max: 0.94, avg: 0.92, change: 0.5 },
        'USD/GBP': { rate: 0.79, inverse: 1.27, min: 0.77, max: 0.81, avg: 0.79, change: -0.3 },
        'EUR/GBP': { rate: 0.86, inverse: 1.16, min: 0.84, max: 0.88, avg: 0.86, change: 0.2 },
        'USD/JPY': { rate: 148.50, inverse: 0.0067, min: 147.80, max: 149.20, avg: 148.50, change: 1.2 },
        'EUR/USD': { rate: 1.09, inverse: 0.92, min: 1.07, max: 1.11, avg: 1.09, change: -0.5 },
        'GBP/USD': { rate: 1.27, inverse: 0.79, min: 1.25, max: 1.29, avg: 1.27, change: 0.3 },
        'GBP/EUR': { rate: 1.16, inverse: 0.86, min: 1.14, max: 1.18, avg: 1.16, change: -0.2 },
        'JPY/USD': { rate: 0.0067, inverse: 148.50, min: 0.0066, max: 0.0068, avg: 0.0067, change: -1.2 },
        'USD/JOD': { rate: 0.71, inverse: 1.41, min: 0.70, max: 0.72, avg: 0.71, change: 0.0 },
        'JOD/EUR': { rate: 1.30, inverse: 0.77, min: 1.29, max: 1.31, avg: 1.30, change: 0.1 },
        'JOD/GBP': { rate: 1.12, inverse: 0.89, min: 1.11, max: 1.13, avg: 1.12, change: -0.2 },
        'EUR/JOD': { rate: 0.77, inverse: 1.30, min: 0.76, max: 0.78, avg: 0.77, change: -0.1 },
        'GBP/JOD': { rate: 0.89, inverse: 1.12, min: 0.88, max: 0.90, avg: 0.89, change: 0.2 }
    };

    const demoInstitutions = [
        'Arab Bank',
        'Jordan Ahli Bank',
        'Bank of Jordan',
        'Cairo Amman Bank',
        'Housing Bank for Trade & Finance'
    ];

    const popularPairs = [
        { pair: 'JOD/USD', rate: 1.41, change: 0.0 },
        { pair: 'USD/EUR', rate: 0.92, change: 0.5 },
        { pair: 'EUR/GBP', rate: 0.86, change: 0.2 },
        { pair: 'USD/JPY', rate: 148.50, change: 1.2 }
    ];

    document.addEventListener('DOMContentLoaded', function () {
        // Initialize
        updateTimestamp();
        loadPopularRates();
        setupEventListeners();

        // Auto-load default rate (JOD/USD)
        setTimeout(() => {
            updateRateDisplay();
        }, 100);

        function updateTimestamp() {
            const now = new Date();
            document.getElementById('rateUpdateTime').textContent = 'Last updated: ' + now.toLocaleString();
        }

        function setupEventListeners() {
            // Currency swap
            document.getElementById('swapCurrencies').addEventListener('click', function () {
                const sourceSelect = document.getElementById('sourceCurrency');
                const targetSelect = document.getElementById('targetCurrency');
                const temp = sourceSelect.value;
                sourceSelect.value = targetSelect.value;
                targetSelect.value = temp;
                updateRateDisplay();
            });

            // Currency selection changes
            document.getElementById('sourceCurrency').addEventListener('change', updateRateDisplay);
            document.getElementById('targetCurrency').addEventListener('change', updateRateDisplay);

            // Converter
            document.getElementById('convertBtn').addEventListener('click', convertCurrency);
            document.getElementById('convertSource').addEventListener('change', updateConverterState);
            document.getElementById('convertTarget').addEventListener('change', updateConverterState);
            document.getElementById('amountToConvert').addEventListener('input', updateConverterState);

            // Popular rates refresh
            document.getElementById('refreshPopularRates').addEventListener('click', loadPopularRates);

            // Institution comparison
            document.getElementById('compareBtn').addEventListener('click', compareInstitutionRates);
            document.getElementById('compareSource').addEventListener('change', updateCompareState);
            document.getElementById('compareTarget').addEventListener('change', updateCompareState);
        }

        function updateRateDisplay() {
            const sourceCurrency = document.getElementById('sourceCurrency').value;
            const targetCurrency = document.getElementById('targetCurrency').value;

            if (!sourceCurrency || !targetCurrency) {
                document.getElementById('rateDisplay').classList.add('hidden');
                document.getElementById('noRateDisplay').classList.remove('hidden');
                return;
            }

            // Show loading
            document.getElementById('rateDisplay').classList.remove('hidden');
            document.getElementById('noRateDisplay').classList.add('hidden');

            // Get demo data for this pair
            const pair = `${sourceCurrency}/${targetCurrency}`;
            const rateData = demoRates[pair];

            if (rateData) {
                // Update display
                document.querySelectorAll('#sourceCurrencyCode, #sourceCurrencyCode2').forEach(el => {
                    el.textContent = sourceCurrency;
                });
                document.querySelectorAll('#targetCurrencyCode, #targetCurrencyCode2').forEach(el => {
                    el.textContent = targetCurrency;
                });

                document.getElementById('currentRate').textContent = rateData.rate.toFixed(4);
                document.getElementById('inverseRate').textContent = rateData.inverse.toFixed(4);
                document.getElementById('minRate').textContent = rateData.min.toFixed(4);
                document.getElementById('maxRate').textContent = rateData.max.toFixed(4);
                document.getElementById('avgRate').textContent = rateData.avg.toFixed(4);
                document.getElementById('institutionName').textContent = demoInstitutions[Math.floor(Math.random() * demoInstitutions.length)];

                updateTimestamp();
            } else {
                // Show error for unsupported pair
                document.getElementById('rateDisplay').classList.add('hidden');
                document.getElementById('noRateDisplay').classList.remove('hidden');
                document.getElementById('noRateDisplay').innerHTML = '<p class="text-error">Exchange rate not available for this currency pair</p>';
            }
        }

        function convertCurrency() {
            const amount = document.getElementById('amountToConvert').value;
            const sourceCurrency = document.getElementById('convertSource').value;
            const targetCurrency = document.getElementById('convertTarget').value;

            if (!amount || !sourceCurrency || !targetCurrency) return;

            const pair = `${sourceCurrency}/${targetCurrency}`;
            const rateData = demoRates[pair];

            if (rateData) {
                const convertedAmount = parseFloat(amount) * rateData.rate;

                document.getElementById('convertedAmount').textContent =
                    `${convertedAmount.toFixed(4)} ${targetCurrency}`;
                document.getElementById('converterRate').textContent =
                    `1 ${sourceCurrency} = ${rateData.rate.toFixed(4)} ${targetCurrency}`;
                document.getElementById('converterResult').classList.remove('hidden');
            } else {
                document.getElementById('converterResult').classList.add('hidden');
                alert('Exchange rate not available for this currency pair');
            }
        }

        function updateConverterState() {
            const sourceCurrency = document.getElementById('convertSource').value;
            const targetCurrency = document.getElementById('convertTarget').value;
            const amount = document.getElementById('amountToConvert').value;

            document.getElementById('convertBtn').disabled = !sourceCurrency || !targetCurrency || !amount;
        }

        function loadPopularRates() {
            const container = document.getElementById('popularRates');
            container.innerHTML = '<div class="col-span-2 text-center"><span class="loading loading-spinner loading-lg"></span></div>';

            // Simulate loading delay
            setTimeout(() => {
                container.innerHTML = '';
                popularPairs.forEach((rate, index) => {
                    const changeClass = rate.change > 0 ? 'text-success' :
                        rate.change < 0 ? 'text-error' : 'text-base-content';
                    const changeIcon = rate.change > 0 ? 'bi-caret-up-fill' :
                        rate.change < 0 ? 'bi-caret-down-fill' : 'bi-dash';

                    // Define gradient backgrounds based on price change
                    let gradientClass;
                    if (rate.change > 0) {
                        // Positive change - green gradients
                        const positiveGradients = [
                            'bg-gradient-to-br from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30 border-green-300/30',
                            'bg-gradient-to-br from-emerald-500/20 to-teal-500/20 hover:from-emerald-500/30 hover:to-teal-500/30 border-emerald-300/30',
                            'bg-gradient-to-br from-teal-500/20 to-cyan-500/20 hover:from-teal-500/30 hover:to-cyan-500/30 border-teal-300/30',
                            'bg-gradient-to-br from-cyan-500/20 to-green-500/20 hover:from-cyan-500/30 hover:to-green-500/30 border-cyan-300/30'
                        ];
                        gradientClass = positiveGradients[index % positiveGradients.length];
                    } else if (rate.change < 0) {
                        // Negative change - red gradients
                        const negativeGradients = [
                            'bg-gradient-to-br from-red-500/20 to-rose-500/20 hover:from-red-500/30 hover:to-rose-500/30 border-red-300/30',
                            'bg-gradient-to-br from-rose-500/20 to-pink-500/20 hover:from-rose-500/30 hover:to-pink-500/30 border-rose-300/30',
                            'bg-gradient-to-br from-pink-500/20 to-red-500/20 hover:from-pink-500/30 hover:to-red-500/30 border-pink-300/30',
                            'bg-gradient-to-br from-orange-500/20 to-red-500/20 hover:from-orange-500/30 hover:to-red-500/30 border-orange-300/30'
                        ];
                        gradientClass = negativeGradients[index % negativeGradients.length];
                    } else {
                        // Neutral change - blue/gray gradients
                        const neutralGradients = [
                            'bg-gradient-to-br from-blue-500/20 to-indigo-500/20 hover:from-blue-500/30 hover:to-indigo-500/30 border-blue-300/30',
                            'bg-gradient-to-br from-indigo-500/20 to-purple-500/20 hover:from-indigo-500/30 hover:to-purple-500/30 border-indigo-300/30',
                            'bg-gradient-to-br from-purple-500/20 to-blue-500/20 hover:from-purple-500/30 hover:to-blue-500/30 border-purple-300/30',
                            'bg-gradient-to-br from-slate-500/20 to-gray-500/20 hover:from-slate-500/30 hover:to-gray-500/30 border-slate-300/30'
                        ];
                        gradientClass = neutralGradients[index % neutralGradients.length];
                    }

                    const card = document.createElement('div');
                    card.innerHTML = `
                            <div class="card ${gradientClass} cursor-pointer transition-all duration-300 transform hover:scale-105 hover:shadow-xl">
                                <div class="card-body text-center p-4">
                                    <h6 class="font-semibold text-base-content/80">${rate.pair}</h6>
                                    <h4 class="text-2xl font-bold text-base-content" id="rate-${index}">0.0000</h4>
                                    <small class="${changeClass} font-medium" id="change-${index}">
                                        <i class="bi ${changeIcon}"></i> 0.0%
                                    </small>
                                </div>
                            </div>
                        `;

                    // Make card clickable
                    card.querySelector('.card').addEventListener('click', function () {
                        const [source, target] = rate.pair.split('/');
                        document.getElementById('sourceCurrency').value = source;
                        document.getElementById('targetCurrency').value = target;
                        updateRateDisplay();
                    });

                    container.appendChild(card);

                    // Animate the rate number
                    animateNumber(`rate-${index}`, 0, rate.rate, 4);
                    animateNumber(`change-${index}`, 0, rate.change, 1);
                });
            }, 500);
        }

        function compareInstitutionRates() {
            const sourceCurrency = document.getElementById('compareSource').value;
            const targetCurrency = document.getElementById('compareTarget').value;

            if (!sourceCurrency || !targetCurrency) return;

            const pair = `${sourceCurrency}/${targetCurrency}`;
            const rateData = demoRates[pair];

            if (rateData) {
                const table = document.getElementById('comparisonTable');
                table.innerHTML = '';

                // Generate demo data for all institutions
                demoInstitutions.forEach((institution, index) => {
                    const variation = (Math.random() - 0.5) * 0.02; // Â±1% variation
                    const rate = rateData.rate * (1 + variation);
                    const inverse = 1 / rate;
                    const minRate = rate * 0.98;
                    const maxRate = rate * 1.02;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                            <td>${institution}</td>
                            <td>${rate.toFixed(4)}</td>
                            <td>${inverse.toFixed(4)}</td>
                            <td>${minRate.toFixed(4)}</td>
                            <td>${maxRate.toFixed(4)}</td>
                            <td>${new Date().toLocaleString()}</td>
                        `;
                    table.appendChild(row);
                });

                document.getElementById('institutionComparison').classList.remove('hidden');
            } else {
                alert('Exchange rate not available for this currency pair');
            }
        }

        function updateCompareState() {
            const sourceCurrency = document.getElementById('compareSource').value;
            const targetCurrency = document.getElementById('compareTarget').value;

            document.getElementById('compareBtn').disabled = !sourceCurrency || !targetCurrency;
        }

        function animateNumber(elementId, start, end, decimals) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const duration = 1500; // 1.5 seconds
            const startTime = performance.now();
            const difference = end - start;

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Easing function for smooth animation
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = start + (difference * easeOutQuart);

                if (decimals === 1) {
                    element.innerHTML = `<i class="bi ${element.innerHTML.includes('bi-caret-up-fill') ? 'bi-caret-up-fill' : element.innerHTML.includes('bi-caret-down-fill') ? 'bi-caret-down-fill' : 'bi-dash'}"></i> ${currentValue.toFixed(1)}%`;
                } else {
                    element.textContent = currentValue.toFixed(decimals);
                }

                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }

            requestAnimationFrame(updateNumber);
        }
    });
</script>
{% endblock %}